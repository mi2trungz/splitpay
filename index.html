Chu·∫©n, nh√¨n screenshot l√† bi·∫øt ƒëang b·ªã 2 l·ªói:

1. **Kh√¥ng c√≥ th·∫ª `<meta name="viewport"...>`** n√™n Safari t·ª± zoom nh·ªè to√†n b·ªô trang.
2. Mobile mode m√¨nh ƒë·ªÉ ch·ªØ h∆°i nh·ªè.

M√¨nh ƒë√£ s·ª≠a c·∫£ hai:

* Th√™m:

  ```html
  <meta name="viewport" content="width=device-width, initial-scale=1">
  ```
* TƒÉng font & padding khi b·∫≠t **‚ÄúCh·∫ø ƒë·ªô giao di·ªán ƒëi·ªán tho·∫°i‚Äù**:

  * body ~ 19‚Äì20px
  * input / textarea / ƒë√°p √°n / n√∫t b·∫•m ƒë·ªÅu to h∆°n, d·ªÖ b·∫•m tay.

D∆∞·ªõi ƒë√¢y l√† **file HTML ho√†n ch·ªânh m·ªõi** (gi·ªØ nguy√™n m·ªçi ch·ª©c nƒÉng c≈©: l∆∞u b·ªô ƒë·ªÅ, l∆∞u tr·∫°ng th√°i, x√°o tr·ªôn, ·∫£nh + zoom, t√¥ xanh/ƒë·ªè, 3 kho·∫£ng tr·∫Øng ‚Üí `___`, mobile toggle‚Ä¶):

> üëâ Ch·ªâ c·∫ßn **copy h·∫øt, d√°n ƒë√®** file hi·ªán t·∫°i.

```html
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quiz luy·ªán c√¢u sai (d√°n ƒë·ªÅ + ƒë√°p √°n)</title>
  <style>
    :root { color-scheme: dark; }
    body {
      font-family: Arial, sans-serif;
      background: #020617;
      padding: 20px;
      color: #e5e7eb;
      font-size: 16px;
      line-height: 1.4;
    }
    .box {
      background: #020617;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.8);
      border: 1px solid #1f2937;
      max-width: 1100px;
      margin: 0 auto 20px auto;
    }
    h2 { margin-top: 0; color: #e5e7eb; }
    p { color: #9ca3af; }

    textarea, input, select {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 1px solid #374151;
      font-family: inherit;
      background: #020617;
      color: #e5e7eb;
      outline: none;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,0.6);
      font-size: 15px;
    }
    textarea:focus, input:focus, select:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px #6366f1;
    }
    textarea { min-height: 180px; resize: vertical; }

    pre {
      background: #020617;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      color: #9ca3af;
      white-space: pre-wrap;
      font-size: 13px;
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 999px;
      background: #6366f1;
      color: white;
      cursor: pointer;
      font-weight: bold;
      margin-right: 8px;
      box-shadow: 0 8px 20px rgba(99,102,241,0.4);
      transition: transform 0.08s, box-shadow 0.08s, opacity 0.15s;
      font-size: 14px;
    }
    button:hover {
      opacity: 0.95;
      box-shadow: 0 10px 26px rgba(99,102,241,0.5);
    }
    button:active {
      transform: translateY(1px);
      box-shadow: 0 6px 18px rgba(99,102,241,0.4);
    }
    .secondary-btn {
      background: #111827;
      color: #e5e7eb;
      box-shadow: 0 4px 12px rgba(15,23,42,0.7);
    }
    .danger-btn {
      background: #b91c1c;
      box-shadow: 0 4px 12px rgba(185,28,28,0.6);
    }

    .inline-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .inline-row > * { flex: 1; min-width: 120px; }
    .inline-row button { flex: 0 0 auto; margin: 0; }

    .question-card {
      padding: 20px;
      background: #020617;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.9);
      border: 1px solid #1f2937;
      max-width: 1100px;
      margin: 10px auto 0 auto;
    }

    #progress { margin-bottom: 8px; font-size: 14px; color: #9ca3af; }
    #quiz-title {
      font-size: 18px;
      margin-bottom: 6px;
      white-space: pre-wrap;
    }
    #quiz-text {
      color: #d1d5db;
      margin-bottom: 8px;
      white-space: pre-wrap;
    }

    /* ·∫£nh c·ªßa c√¢u h·ªèi */
    #quiz-image-wrapper { margin-bottom: 12px; }
    #quiz-image {
      max-width: 100%;
      border-radius: 10px;
      border: 1px solid #1f2937;
      display: block;
      cursor: zoom-in;
      transition: box-shadow 0.12s, transform 0.08s;
    }
    #quiz-image:hover {
      box-shadow: 0 0 0 2px rgba(99,102,241,0.7);
      transform: translateY(-1px);
    }

    /* modal ph√≥ng to ·∫£nh */
    #image-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      cursor: zoom-out;
    }
    #image-modal {
      max-width: 92vw;
      max-height: 92vh;
      border-radius: 12px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.9);
    }

    /* Block answer style */
    .choice-row { margin-bottom: 10px; }
    .choice-card {
      width: 100%;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: #020617;
      cursor: pointer;
      transition: border-color 0.12s, background 0.12s,
                  box-shadow 0.12s, transform 0.05s;
      text-align: left;
    }
    .choice-card:hover {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px rgba(79,70,229,0.5);
    }
    .choice-card.selected {
      border-color: #6366f1;
      background: #111827;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.8);
      transform: translateY(-1px);
    }
    .choice-prefix {
      font-weight: 600;
      color: #9ca3af;
      flex-shrink: 0;
      min-width: 20px;
    }
    .choice-text {
      color: #e5e7eb;
      white-space: pre-wrap;
    }

    /* t√¥ m√†u sau khi tr·∫£ l·ªùi */
    .choice-card.correct {
      border-color: #22c55e;
      background: #052e16;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.9);
    }
    .choice-card.incorrect {
      border-color: #ef4444;
      background: #450a0a;
      box-shadow: 0 0 0 1px rgba(248,113,113,0.9);
    }

    #status { margin-top: 12px; font-weight: bold; }
    #status.ok { color: #4ade80; }
    #status.err { color: #fb7185; }

    .small-hint {
      font-size: 12px;
      color: #9ca3af;
      margin-top: -6px;
      margin-bottom: 10px;
    }

    /* ===== Ch·∫ø ƒë·ªô giao di·ªán ƒëi·ªán tho·∫°i ===== */
    body.mobile-mode {
      font-size: 19px;
      line-height: 1.5;
      padding: 10px 6px;
    }
    body.mobile-mode .box,
    body.mobile-mode .question-card {
      max-width: 100%;
      margin: 0 0 16px 0;
      border-radius: 0;
      box-shadow: none;
      border-left: none;
      border-right: none;
    }
    body.mobile-mode h2 {
      font-size: 22px;
    }
    body.mobile-mode pre {
      font-size: 14px;
    }
    body.mobile-mode textarea,
    body.mobile-mode input,
    body.mobile-mode select {
      font-size: 18px;
      padding: 10px 10px;
    }
    body.mobile-mode button {
      font-size: 17px;
      padding: 12px 18px;
    }
    body.mobile-mode #quiz-title {
      font-size: 21px;
    }
    body.mobile-mode #progress {
      font-size: 15px;
    }
    body.mobile-mode .choice-card {
      padding: 16px 18px;
    }
    body.mobile-mode .choice-text {
      font-size: 18px;
    }
    body.mobile-mode .choice-prefix {
      font-size: 18px;
    }
  </style>
</head>
<body>

<div class="box">
  <h2>B∆∞·ªõc 1: D√°n ƒë·ªÅ</h2>
  <p><strong>Format v√≠ d·ª• (c√≥ ·∫£nh v√† kh√¥ng ·∫£nh):</strong></p>
  <pre>
C√¢u 1: ƒê√¢y l√† c√¢u h·ªèi c√≥ h√¨nh minh ho·∫°.
IMG: https://example.com/hinh1.png
A. ƒê√°p √°n A
B. ƒê√°p √°n B
C. ƒê√°p √°n C
D. ƒê√°p √°n D

C√¢u 2: C√¢u n√†y d√πng th·∫≥ng th·∫ª &lt;img&gt;.
&lt;img src="https://example.com/hinh2.png"&gt;
A. ƒê√°p √°n A
B. ƒê√°p √°n B
C. ƒê√°p √°n C
D. ƒê√°p √°n D

C√¢u 3: Kh√¥ng c√≥ h√¨nh.
A. ƒê√°p √°n A
B. ƒê√°p √°n B
C. ƒê√°p √°n C
D. ƒê√°p √°n D
  </pre>

  <textarea id="rawQuestions" placeholder="D√°n t·∫•t c·∫£ c√¢u h·ªèi v√†o ƒë√¢y..."></textarea>

  <h2>B∆∞·ªõc 2: Nh·∫≠p ƒë√°p √°n ƒë√∫ng</h2>
  <p>
    V√≠ d·ª•: n·∫øu c√≥ 3 c√¢u v√† ƒë√°p √°n l·∫ßn l∆∞·ª£t l√† A, B, D ‚Üí nh·∫≠p <strong>ABD</strong>.<br>
    K√Ω t·ª± th·ª© 1 ·ª©ng v·ªõi c√¢u h·ªèi <strong>ƒë·∫ßu ti√™n</strong> trong √¥ tr√™n (b·∫•t k·ªÉ s·ªë 14, 15...).
  </p>
  <input id="answerKey" placeholder="V√≠ d·ª•: ABDCDAB..." />

  <h2>B∆∞·ªõc 3: ƒê·∫∑t t√™n & l∆∞u b·ªô ƒë·ªÅ</h2>
  <div class="small-hint">
    V√≠ d·ª•: <em>‚ÄúCh∆∞∆°ng 3 - IFE‚Äù</em>, <em>‚Äúƒê·ªÅ c≈© 2024 - IRP/PPP‚Äù</em>...
  </div>
  <div class="inline-row" style="margin-bottom: 12px;">
    <input id="setName" placeholder="T√™n b·ªô ƒë·ªÅ..." />
    <button onclick="saveCurrentSet()">L∆∞u b·ªô ƒë·ªÅ</button>
  </div>

  <h2>B·ªô ƒë·ªÅ ƒë√£ l∆∞u</h2>
  <div class="inline-row">
    <select id="savedSetsSelect"></select>
    <button onclick="loadSelectedSet()">T·∫£i b·ªô ƒë·ªÅ</button>
    <button class="danger-btn" onclick="deleteSelectedSet()">Xo√° b·ªô ƒë·ªÅ</button>
  </div>
  <div class="inline-row" style="margin-top:8px;">
    <button class="secondary-btn" onclick="exportSets()">Xu·∫•t t·∫•t c·∫£ b·ªô ƒë·ªÅ (.json)</button>
    <button onclick="triggerImportSets()">T·∫£i b·ªô ƒë·ªÅ t·ª´ file</button>
  </div>
  <input type="file" id="setsFileInput" accept="application/json" style="display:none" onchange="importSetsFromFile(event)" />
  <div class="small-hint">
    B·ªô ƒë·ªÅ ƒë∆∞·ª£c l∆∞u trong LocalStorage. B·∫°n c√≥ th·ªÉ xu·∫•t ra file JSON ƒë·ªÉ backup, r·ªìi t·∫£i l√™n l·∫°i khi ƒë·ªïi m√°y ho·∫∑c tr√¨nh duy·ªát.
  </div>

  <hr style="border-color:#1f2937;margin:18px 0;" />

  <button onclick="createQuiz()">T·∫°o ƒë·ªÅ &amp; b·∫Øt ƒë·∫ßu l√†m b√†i</button>

  <div style="margin-top:14px;">
    <button class="secondary-btn" onclick="toggleMobileMode()">
      Ch·∫ø ƒë·ªô giao di·ªán ƒëi·ªán tho·∫°i: <span id="mobileModeLabel">T·∫Øt</span>
    </button>
  </div>
</div>

<div class="question-card" id="quiz-box" style="display:none;">
  <div id="progress"></div>
  <h2 id="quiz-title">C√¢u h·ªèi</h2>
  <div id="quiz-text"></div>

  <div id="quiz-image-wrapper" style="display:none;">
    <img id="quiz-image" alt="H√¨nh minh ho·∫° c√¢u h·ªèi" />
  </div>

  <div class="choice-row">
    <div class="choice-card" data-index="0">
      <span class="choice-prefix">A.</span>
      <span class="choice-text" id="c1"></span>
    </div>
  </div>
  <div class="choice-row">
    <div class="choice-card" data-index="1">
      <span class="choice-prefix">B.</span>
      <span class="choice-text" id="c2"></span>
    </div>
  </div>
  <div class="choice-row">
    <div class="choice-card" data-index="2">
      <span class="choice-prefix">C.</span>
      <span class="choice-text" id="c3"></span>
    </div>
  </div>
  <div class="choice-row">
    <div class="choice-card" data-index="3">
      <span class="choice-prefix">D.</span>
      <span class="choice-text" id="c4"></span>
    </div>
  </div>

  <button onclick="submitAnswer()">Tr·∫£ l·ªùi</button>
  <button class="secondary-btn" onclick="restartQuiz()">L√†m l·∫°i t·ª´ ƒë·∫ßu</button>

  <div id="status"></div>
</div>

<!-- overlay ph√≥ng to ·∫£nh -->
<div id="image-modal-overlay">
  <img id="image-modal" alt="Zoom image" />
</div>

<script>
let questions = [];   // { text, choices[4], correctIndex, image? }
let roundList = [];
let wrongList = [];
let current = 0;
let round = 1;
let finished = false;
let selectedChoice = null;
let shuffleEnabled = false;

const LS_KEY_SETS  = "quizSets_v1";
const LS_KEY_STATE = "quizCurrentState_v1";

/* ---------- ti·ªán √≠ch ---------- */
function shuffleArray(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* chuy·ªÉn m·ªçi chu·ªói c√≥ ‚â•3 space li√™n ti·∫øp th√†nh ___ */
function normalizeSpaces(txt) {
  return txt.replace(/ {3,}/g, "___");
}

/* ---------- b·ªô ƒë·ªÅ ---------- */
function getSavedSets() {
  try {
    const raw = localStorage.getItem(LS_KEY_SETS);
    if (!raw) return [];
    const parsed = JSON.parse(raw);
    return Array.isArray(parsed) ? parsed : [];
  } catch { return []; }
}
function saveSetsToLS(sets) {
  try { localStorage.setItem(LS_KEY_SETS, JSON.stringify(sets)); }
  catch {}
}
function refreshSavedSetsUI() {
  const select = document.getElementById("savedSetsSelect");
  const sets = getSavedSets();
  select.innerHTML = "";
  if (!sets.length) {
    const opt = document.createElement("option");
    opt.value = "";
    opt.textContent = "Ch∆∞a c√≥ b·ªô ƒë·ªÅ n√†o ƒë∆∞·ª£c l∆∞u";
    select.appendChild(opt);
    select.disabled = true;
    return;
  }
  select.disabled = false;
  sets.forEach((set, idx) => {
    const opt = document.createElement("option");
    opt.value = idx;
    opt.textContent = set.name;
    select.appendChild(opt);
  });
}

function saveCurrentSet() {
  const name = document.getElementById("setName").value.trim();
  const raw  = document.getElementById("rawQuestions").value.trim();
  const keyInput = document.getElementById("answerKey").value
                    .trim().toUpperCase().replace(/\s+/g,"");
  if (!name)    return alert("B·∫°n ch∆∞a nh·∫≠p t√™n b·ªô ƒë·ªÅ.");
  if (!raw)     return alert("B·∫°n ch∆∞a d√°n ƒë·ªÅ v√†o.");
  if (!keyInput)return alert("B·∫°n ch∆∞a nh·∫≠p chu·ªói ƒë√°p √°n.");

  const sets = getSavedSets();
  const idx  = sets.findIndex(s => s.name === name);
  const data = { name, rawQuestions: raw, answerKey: keyInput };

  if (idx >= 0) {
    if (!confirm("ƒê√£ c√≥ b·ªô ƒë·ªÅ tr√πng t√™n. Ghi ƒë√®?")) return;
    sets[idx] = data;
  } else sets.push(data);

  saveSetsToLS(sets);
  refreshSavedSetsUI();
  alert('ƒê√£ l∆∞u b·ªô ƒë·ªÅ "'+name+'".');
}

function loadSelectedSet() {
  const select = document.getElementById("savedSetsSelect");
  const idx = parseInt(select.value,10);
  const sets = getSavedSets();
  if (isNaN(idx) || !sets[idx]) return alert("Kh√¥ng c√≥ b·ªô ƒë·ªÅ h·ª£p l·ªá ƒë·ªÉ t·∫£i.");
  const set = sets[idx];
  document.getElementById("setName").value      = set.name;
  document.getElementById("rawQuestions").value = set.rawQuestions;
  document.getElementById("answerKey").value    = set.answerKey;
  alert("ƒê√£ t·∫£i b·ªô ƒë·ªÅ: "+set.name);
}

function deleteSelectedSet() {
  const select = document.getElementById("savedSetsSelect");
  const idx = parseInt(select.value,10);
  const sets = getSavedSets();
  if (isNaN(idx) || !sets[idx]) return alert("Kh√¥ng c√≥ b·ªô ƒë·ªÅ h·ª£p l·ªá ƒë·ªÉ xo√°.");
  if (!confirm('Xo√° b·ªô ƒë·ªÅ "'+sets[idx].name+'"?')) return;
  sets.splice(idx,1);
  saveSetsToLS(sets);
  refreshSavedSetsUI();
  alert("ƒê√£ xo√° b·ªô ƒë·ªÅ.");
}

/* --- export / import b·ªô ƒë·ªÅ --- */
function exportSets() {
  const sets = getSavedSets();
  if (!sets.length) return alert("Ch∆∞a c√≥ b·ªô ƒë·ªÅ n√†o ƒë·ªÉ xu·∫•t.");
  const blob = new Blob([JSON.stringify(sets,null,2)],{type:"application/json"});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement("a");
  a.href = url;
  a.download = "quiz_sets_"+new Date().toISOString().split("T")[0]+".json";
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
function triggerImportSets() {
  document.getElementById("setsFileInput").click();
}
function importSetsFromFile(ev) {
  const file = ev.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      if (!Array.isArray(data)) return alert("File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng (ph·∫£i l√† m·∫£ng JSON).");
      let cur = getSavedSets();
      data.forEach(ns => {
        if (!ns || typeof ns!=="object") return;
        if (!ns.name || !ns.rawQuestions || !ns.answerKey) return;
        const i = cur.findIndex(s=>s.name===ns.name);
        if (i>=0) cur[i]=ns; else cur.push(ns);
      });
      saveSetsToLS(cur);
      refreshSavedSetsUI();
      alert("ƒê√£ import b·ªô ƒë·ªÅ. T·ªïng s·ªë b·ªô ƒë·ªÅ: "+cur.length);
    } catch {
      alert("Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c file JSON b·ªô ƒë·ªÅ.");
    } finally { ev.target.value=""; }
  };
  reader.readAsText(file);
}

/* ---------- l∆∞u / kh√¥i ph·ª•c tr·∫°ng th√°i quiz ---------- */
function saveCurrentState() {
  if (!questions.length) { localStorage.removeItem(LS_KEY_STATE); return; }
  const state = {
    rawQuestions: document.getElementById("rawQuestions").value.trim(),
    answerKey: document.getElementById("answerKey").value.trim().toUpperCase().replace(/\s+/g,""),
    setName: document.getElementById("setName").value.trim(),
    questions,
    shuffleEnabled,
    round,
    current,
    roundList,
    wrongList,
    finished
  };
  try { localStorage.setItem(LS_KEY_STATE, JSON.stringify(state)); } catch {}
}

function tryRestoreQuizState() {
  try {
    const raw = localStorage.getItem(LS_KEY_STATE);
    if (!raw) return;
    const state = JSON.parse(raw);
    if (!state || !Array.isArray(state.questions) || !state.questions.length) return;

    const label = state.setName ? '"'+state.setName+'"' : "(ch∆∞a ƒë·∫∑t t√™n)";
    if (!confirm(`Ph√°t hi·ªán b·∫°n c√≥ b√†i ƒëang l√†m d·ªü cho b·ªô ƒë·ªÅ ${label}.\nB·∫°n c√≥ mu·ªën ti·∫øp t·ª•c kh√¥ng?`)) return;

    if (state.rawQuestions) document.getElementById("rawQuestions").value = state.rawQuestions;
    if (state.answerKey)    document.getElementById("answerKey").value    = state.answerKey;
    if (state.setName)      document.getElementById("setName").value      = state.setName;

    questions       = state.questions;
    shuffleEnabled  = !!state.shuffleEnabled;
    round           = state.round   || 1;
    current         = state.current || 0;
    roundList       = Array.isArray(state.roundList) && state.roundList.length
                      ? state.roundList : questions.map((_,i)=>i);
    wrongList       = Array.isArray(state.wrongList) ? state.wrongList : [];
    finished        = !!state.finished;

    document.getElementById("quiz-box").style.display = "block";
    renderQuestion();
  } catch {}
}

/* ---------- parse ƒë·ªÅ (h·ªó tr·ª£ <img> & IMG:, c√¢u h·ªèi nhi·ªÅu d√≤ng) ---------- */
function parseQuestions(raw) {
  const blocks = raw
    .split(/(?=C√¢u\s*\d+\s*:)/g)
    .map(b=>b.trim())
    .filter(b=>b.length>0);

  const parsed = [];

  blocks.forEach(origBlock => {
    if (!origBlock) return;
    let block = origBlock.trim();

    // 1) ∆ØU TI√äN t√¨m th·∫ª <img ...> trong c·∫£ block
    let imageUrl = null;
    const imgTagMatch = block.match(/<img\b[^>]*src=["']([^"']+)["'][^>]*>/i);
    if (imgTagMatch) {
      imageUrl = imgTagMatch[1].trim();
      block = block.replace(imgTagMatch[0], "").trim(); // b·ªè <img> kh·ªèi text
    }

    // 2) T√¨m d√≤ng "C√¢u xx:"
    const qMatch = block.match(/^C√¢u\s*\d+\s*:.*$/m);
    if (!qMatch) return;

    const headerLine = qMatch[0];
    const afterHeader = block.slice(qMatch.index + headerLine.length);

    // 3) Gom th√™m c√°c d√≤ng ti·∫øp theo thu·ªôc c√¢u h·ªèi
    const lines = afterHeader.split(/\r?\n/);
    let extraLines = [];
    let offsetInAfter = 0;

    for (let i = 0; i < lines.length; i++) {
      const ln = lines[i];
      const trimmed = ln.trim();

      // N·∫øu d√≤ng b·∫Øt ƒë·∫ßu b·∫±ng A./B./C./D. ho·∫∑c IMG: ho·∫∑c <img> => d·ª´ng
      if (trimmed.match(/^(?:[ABCD]\.|IMG\s*:|<img\b)/i)) {
        break;
      }

      extraLines.push(ln);
      offsetInAfter += ln.length + 1; // +1 cho k√Ω t·ª± xu·ªëng d√≤ng
    }

    let questionText = headerLine;
    if (extraLines.length) {
      questionText += "\n" + extraLines.join("\n");
    }
    questionText = questionText.trim();
    questionText = normalizeSpaces(questionText);

    let after = afterHeader.slice(offsetInAfter).trim();

    // 4) N·∫øu CH∆ØA c√≥ h√¨nh, m·ªõi t√¨m th√™m d√≤ng "IMG: ..."
    if (!imageUrl) {
      const imgLineMatch = after.match(/^IMG\s*:\s*(.+)$/m);
      if (imgLineMatch) {
        let imgLine = imgLineMatch[1].trim();
        const tagMatch2 = imgLine.match(/<img\b[^>]*src=["']([^"']+)["'][^>]*>/i);
        if (tagMatch2) {
          imageUrl = tagMatch2[1].trim();
        } else {
          imageUrl = imgLine;
        }
        after = after.replace(imgLineMatch[0], "").trim();
      }
    }

    // 5) Parse ƒë√°p √°n A/B/C/D
    const choicesObj = { A:"", B:"", C:"", D:"" };
    const re = /([ABCD])\.(.*?)(?=(?:[ABCD]\.|$))/gs;
    let m;
    while ((m = re.exec(after)) !== null) {
      const letter = m[1];
      const text = m[2]
        .replace(/\r?\n/g, " ")
        .replace(/\t/g, " ")
        .trimEnd();
      choicesObj[letter] = text;
    }

    const choiceArrRaw = ["A","B","C","D"].map(ch => (choicesObj[ch]||"").trim());
    if (!questionText || choiceArrRaw.some(c=>!c)) return;

    const choiceArr = choiceArrRaw.map(c => normalizeSpaces(c));

    parsed.push({
      text: questionText,
      choices: choiceArr,
      image: imageUrl || null
    });
  });

  return parsed;
}

/* ---------- t·∫°o ƒë·ªÅ t·ª´ text + ƒë√°p √°n ---------- */
function createQuiz() {
  const raw = document.getElementById("rawQuestions").value.trim();
  const key = document.getElementById("answerKey").value
                .trim().toUpperCase().replace(/\s+/g,"");
  if (!raw) return alert("B·∫°n ch∆∞a d√°n ƒë·ªÅ.");
  if (!key) return alert("B·∫°n ch∆∞a nh·∫≠p chu·ªói ƒë√°p √°n.");

  const parsed = parseQuestions(raw);
  if (!parsed.length)
    return alert("Kh√¥ng parse ƒë∆∞·ª£c c√¢u h·ªèi n√†o. Ki·ªÉm tra l·∫°i format 'C√¢u xx:' v√† A./B./C./D.");

  if (key.length !== parsed.length)
    return alert("S·ªë k√Ω t·ª± trong ƒë√°p √°n ("+key.length+") kh√°c s·ªë c√¢u h·ªèi ("+parsed.length+").");

  shuffleEnabled = confirm("B·∫°n c√≥ mu·ªën x√°o tr·ªôn th·ª© t·ª± c√¢u h·ªèi kh√¥ng?\nOK = C√≥, Cancel = Kh√¥ng.");

  const map = {A:0,B:1,C:2,D:3};
  const tmp = [];
  for (let i=0;i<parsed.length;i++) {
    const k   = key[i];
    const idx = map[k];
    if (idx===undefined)
      return alert("K√Ω t·ª± ƒë√°p √°n kh√¥ng h·ª£p l·ªá t·∫°i v·ªã tr√≠ "+(i+1)+": "+k+" (ch·ªâ A/B/C/D).");
    tmp.push({
      text: parsed[i].text,
      choices: parsed[i].choices,
      correctIndex: idx,
      image: parsed[i].image || null
    });
  }
  questions = tmp;
  startQuiz();
}

/* ---------- logic quiz ---------- */
function startQuiz() {
  if (!questions.length) return alert("Ch∆∞a c√≥ c√¢u h·ªèi.");
  let indices = questions.map((_,i)=>i);
  if (shuffleEnabled) indices = shuffleArray(indices);

  roundList = indices;
  wrongList = [];
  round     = 1;
  current   = 0;
  finished  = false;

  document.getElementById("quiz-box").style.display = "block";
  renderQuestion();
}

function clearChoiceStyles() {
  document.querySelectorAll(".choice-card").forEach(card => {
    card.classList.remove("correct","incorrect");
  });
}

function renderQuestion() {
  const qIndex = roundList[current];
  const q = questions[qIndex];

  document.getElementById("progress").innerText =
    `L∆∞·ª£t ${round} ‚Äì C√¢u ${current+1}/${roundList.length} (T·ªïng: ${questions.length} c√¢u)`;
  document.getElementById("quiz-title").innerText = q.text;
  document.getElementById("quiz-text").innerText  = "";

  // render ·∫£nh n·∫øu c√≥
  const imgWrap = document.getElementById("quiz-image-wrapper");
  const imgEl   = document.getElementById("quiz-image");
  if (q.image) {
    imgEl.src = q.image;
    imgWrap.style.display = "block";
  } else {
    imgWrap.style.display = "none";
    imgEl.removeAttribute("src");
  }

  document.getElementById("c1").innerText = q.choices[0];
  document.getElementById("c2").innerText = q.choices[1];
  document.getElementById("c3").innerText = q.choices[2];
  document.getElementById("c4").innerText = q.choices[3];

  const st = document.getElementById("status");
  st.innerText = ""; st.className = "";

  selectedChoice = null;
  clearChoiceStyles();
  updateChoiceSelection();
  saveCurrentState();
}

function updateChoiceSelection() {
  document.querySelectorAll(".choice-card").forEach(card=>{
    const idx = Number(card.getAttribute("data-index"));
    card.classList.toggle("selected", idx===selectedChoice);
  });
}

function attachChoiceEvents() {
  document.querySelectorAll(".choice-card").forEach(card=>{
    card.addEventListener("click", ()=>{
      selectedChoice = Number(card.getAttribute("data-index"));
      updateChoiceSelection();
    });
  });
}

/* ---- zoom ·∫£nh ---- */
function attachImageZoomEvents() {
  const quizImg   = document.getElementById("quiz-image");
  const overlay   = document.getElementById("image-modal-overlay");
  const modalImg  = document.getElementById("image-modal");

  quizImg.addEventListener("click", () => {
    if (!quizImg.src) return;
    modalImg.src = quizImg.src;
    overlay.style.display = "flex";
  });

  overlay.addEventListener("click", () => {
    overlay.style.display = "none";
    modalImg.removeAttribute("src");
  });
}

function submitAnswer() {
  if (finished) return;
  if (selectedChoice===null) return alert("H√£y ch·ªçn m·ªôt ƒë√°p √°n.");

  const qIndex = roundList[current];
  const q = questions[qIndex];
  const st = document.getElementById("status");
  const cards = document.querySelectorAll(".choice-card");

  clearChoiceStyles();

  if (selectedChoice === q.correctIndex) {
    st.innerText = "ƒê√∫ng r·ªìi! ‚úÖ";
    st.className = "ok";
    if (cards[selectedChoice]) {
      cards[selectedChoice].classList.add("correct");
    }
  } else {
    st.innerText = "Sai ‚Äì c√¢u n√†y s·∫Ω ƒë∆∞·ª£c l√†m l·∫°i ·ªü l∆∞·ª£t sau.";
    st.className = "err";
    if (cards[selectedChoice]) {
      cards[selectedChoice].classList.add("incorrect");
    }
    if (!wrongList.includes(qIndex)) wrongList.push(qIndex);
  }

  saveCurrentState();
  setTimeout(nextQuestion, 900);
}

function nextQuestion() {
  if (finished) return;
  if (current < roundList.length - 1) {
    current++;
    renderQuestion();
  } else {
    const st = document.getElementById("status");
    if (wrongList.length) {
      round++;
      let next = [...wrongList];
      wrongList = [];
      if (shuffleEnabled) next = shuffleArray(next);
      roundList = next;
      current   = 0;
      st.innerText = `B·∫°n v·∫´n c√≤n c√¢u sai. Chuy·ªÉn sang l∆∞·ª£t ${round} ch·ªâ g·ªìm c√°c c√¢u sai.`;
      st.className = "err";
      renderQuestion();
    } else {
      finished = true;
      st.innerText = "üéâ Ho√†n th√†nh! T·∫•t c·∫£ c√¢u h·ªèi ƒë·ªÅu ƒë√∫ng.";
      st.className = "ok";
      saveCurrentState();
    }
  }
}

function restartQuiz() {
  if (!questions.length) return;
  let indices = questions.map((_,i)=>i);
  if (shuffleEnabled) indices = shuffleArray(indices);
  roundList = indices;
  wrongList = [];
  round = 1;
  current = 0;
  finished = false;
  renderQuestion();
}

/* ----- Ch·∫ø ƒë·ªô giao di·ªán ƒëi·ªán tho·∫°i ----- */
function toggleMobileMode() {
  const body = document.body;
  const enabled = body.classList.toggle("mobile-mode");
  const label = document.getElementById("mobileModeLabel");
  if (label) label.textContent = enabled ? "B·∫≠t" : "T·∫Øt";
  try { localStorage.setItem("quizMobileMode", enabled ? "1" : "0"); } catch {}
}

/* ---------- init ---------- */
function init() {
  attachChoiceEvents();
  attachImageZoomEvents();
  refreshSavedSetsUI();
  tryRestoreQuizState();

  // kh√¥i ph·ª•c mobile-mode n·∫øu c√≥
  try {
    const mm = localStorage.getItem("quizMobileMode");
    if (mm === "1") {
      document.body.classList.add("mobile-mode");
      const label = document.getElementById("mobileModeLabel");
      if (label) label.textContent = "B·∫≠t";
    }
  } catch {}
}
document.addEventListener("DOMContentLoaded", init);
</script>

</body>
</html>
```

B·∫°n deploy l·∫°i r·ªìi m·ªü tr√™n ƒëi·ªán tho·∫°i, b·∫≠t **‚ÄúCh·∫ø ƒë·ªô giao di·ªán ƒëi·ªán tho·∫°i: B·∫≠t‚Äù**, n·∫øu v·∫´n th·∫•y nh·ªè qu√° m√¨nh c√≥ th·ªÉ tƒÉng font th√™m n·ªØa (v√≠ d·ª• 21‚Äì22px).
