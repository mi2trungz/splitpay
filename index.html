<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Quiz luy·ªán c√¢u sai (d√°n ƒë·ªÅ + ƒë√°p √°n)</title>
  <style>
    :root {
      color-scheme: dark;
    }

    body {
      font-family: Arial, sans-serif;
      background: #020617; /* slate-950 */
      padding: 20px;
      color: #e5e7eb; /* gray-200 */
    }

    .box {
      background: #020617;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.8);
      border: 1px solid #1f2937; /* gray-800 */
      max-width: 1100px;
      margin-left: auto;
      margin-right: auto;
    }

    h2 {
      margin-top: 0;
      color: #e5e7eb;
    }

    p {
      color: #9ca3af; /* gray-400 */
    }

    textarea,
    input {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 1px solid #374151; /* gray-700 */
      font-family: inherit;
      background: #020617;
      color: #e5e7eb;
      outline: none;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,0.6);
    }

    textarea:focus,
    input:focus {
      border-color: #6366f1; /* indigo-500 */
      box-shadow: 0 0 0 1px #6366f1;
    }

    textarea {
      min-height: 180px;
      resize: vertical;
    }

    pre {
      background: #020617;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      color: #9ca3af;
      white-space: pre-wrap;
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 999px;
      background: #6366f1; /* indigo-500 */
      color: white;
      cursor: pointer;
      font-weight: bold;
      margin-right: 8px;
      box-shadow: 0 8px 20px rgba(99,102,241,0.4);
      transition: transform 0.08s, box-shadow 0.08s, opacity 0.15s;
    }

    button:hover {
      opacity: 0.95;
      box-shadow: 0 10px 26px rgba(99,102,241,0.5);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 6px 18px rgba(99,102,241,0.4);
    }

    .secondary-btn {
      background: #111827;
      color: #e5e7eb;
      box-shadow: 0 4px 12px rgba(15,23,42,0.7);
    }

    .question-card {
      padding: 20px;
      background: #020617;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.9);
      margin-top: 10px;
      border: 1px solid #1f2937;
      max-width: 1100px;
      margin-left: auto;
      margin-right: auto;
    }

    #progress {
      margin-bottom: 8px;
      font-size: 14px;
      color: #9ca3af;
    }

    #quiz-title {
      font-size: 18px;
      margin-bottom: 6px;
    }

    #quiz-text {
      color: #d1d5db;
      margin-bottom: 12px;
    }

    /* ====== BLOCK ANSWER STYLE ====== */
    .choice-row {
      margin-bottom: 10px;
    }

    .choice-card {
      width: 100%;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: #020617;
      cursor: pointer;
      transition: border-color 0.12s, background 0.12s,
                  box-shadow 0.12s, transform 0.05s;
      text-align: left;
    }

    .choice-card:hover {
      border-color: #4f46e5;
      background: #020617;
      box-shadow: 0 0 0 1px rgba(79,70,229,0.5);
    }

    .choice-card.selected {
      border-color: #6366f1;
      background: #111827;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.8);
      transform: translateY(-1px);
    }

    .choice-prefix {
      font-weight: 600;
      color: #9ca3af;
      flex-shrink: 0;
      min-width: 20px;
    }

    .choice-text {
      color: #e5e7eb;
      white-space: normal;
    }

    #status {
      margin-top: 12px;
      font-weight: bold;
    }

    #status.ok {
      color: #4ade80; /* green-400 */
    }

    #status.err {
      color: #fb7185; /* rose-400 */
    }
  </style>
</head>
<body>

<div class="box">
  <h2>B∆∞·ªõc 1: D√°n ƒë·ªÅ</h2>
  <p><strong>Format v√≠ d·ª•:</strong></p>
  <pre>
C√¢u 14: Assume that U.S. and British investors require a real return of 2%. If the nominal U.S. interest rate is 15%, and the nominal British rate is 13%, then according to the IFE, the British inflation rate is expected to be about the U.S. inflation rate, and the British pound is expected to .
A.2 percentage points above; depreciate by about 2%
B.3 percentage points above; depreciate by about 3%
C.3 percentage points below; appreciate by about 3%
D.2 percentage points below; appreciate by about 2%

C√¢u 15: Assume U.S. and Swiss investors require a real rate of return of 3%. Assume the nominal U.S. interest rate is 6% and the nominal Swiss rate is 4%. According to the international Fisher effect, the franc will by about .
A.appreciate; 3%  B.appreciate; 1%  C.depreciate; 3%  D.appreciate; 2%
  </pre>

  <textarea id="rawQuestions" placeholder="D√°n t·∫•t c·∫£ c√¢u h·ªèi v√†o ƒë√¢y..."></textarea>

  <h2>B∆∞·ªõc 2: Nh·∫≠p ƒë√°p √°n ƒë√∫ng</h2>
  <p>
    V√≠ d·ª•: n·∫øu c√≥ 3 c√¢u v√† ƒë√°p √°n l·∫ßn l∆∞·ª£t l√† A, B, D ‚Üí nh·∫≠p <strong>ABD</strong>.<br>
    K√Ω t·ª± th·ª© 1 ·ª©ng v·ªõi c√¢u h·ªèi <strong>ƒë·∫ßu ti√™n</strong> trong √¥ tr√™n (b·∫•t k·ªÉ s·ªë 14, 15...).
  </p>
  <input id="answerKey" placeholder="V√≠ d·ª•: ABDCDAB..." />

  <button onclick="createQuiz()">T·∫°o ƒë·ªÅ &amp; b·∫Øt ƒë·∫ßu l√†m b√†i</button>
</div>

<div class="question-card" id="quiz-box" style="display:none;">
  <div id="progress"></div>
  <h2 id="quiz-title">C√¢u h·ªèi</h2>
  <div id="quiz-text"></div>

  <div class="choice-row">
    <div class="choice-card" data-index="0">
      <span class="choice-prefix">A.</span>
      <span class="choice-text" id="c1"></span>
    </div>
  </div>

  <div class="choice-row">
    <div class="choice-card" data-index="1">
      <span class="choice-prefix">B.</span>
      <span class="choice-text" id="c2"></span>
    </div>
  </div>

  <div class="choice-row">
    <div class="choice-card" data-index="2">
      <span class="choice-prefix">C.</span>
      <span class="choice-text" id="c3"></span>
    </div>
  </div>

  <div class="choice-row">
    <div class="choice-card" data-index="3">
      <span class="choice-prefix">D.</span>
      <span class="choice-text" id="c4"></span>
    </div>
  </div>

  <button onclick="submitAnswer()">Tr·∫£ l·ªùi</button>
  <button class="secondary-btn" onclick="restartQuiz()">L√†m l·∫°i t·ª´ ƒë·∫ßu</button>

  <div id="status"></div>
</div>

<script>
let questions = [];   // { text, choices[4], correctIndex }
let roundList = [];   // index c√¢u trong l∆∞·ª£t hi·ªán t·∫°i
let wrongList = [];   // index c√¢u sai d√πng cho l∆∞·ª£t sau
let current = 0;
let round = 1;
let finished = false;
let selectedChoice = null;
let shuffleEnabled = false; // c√≥ b·∫≠t x√°o tr·ªôn kh√¥ng

// ======== H√ÄM SHUFFLE M·∫¢NG (FISHER-YATES) ========
function shuffleArray(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// ==================== PARSE ƒê·ªÄ T·ª™ TEXT ====================
function parseQuestions(raw) {
  // T√°ch th√†nh t·ª´ng block b·∫Øt ƒë·∫ßu b·∫±ng "C√¢u xx:"
  const blocks = raw
    .split(/(?=C√¢u\s*\d+\s*:)/g)
    .map(b => b.trim())
    .filter(b => b.length > 0);

  const parsed = [];

  blocks.forEach((block, idx) => {
    // T√¨m d√≤ng c√¢u h·ªèi (C√¢u xx: ...)
    const qMatch = block.match(/^C√¢u\s*\d+\s*:.*$/m);
    if (!qMatch) {
      console.warn("Kh√¥ng t√¨m ƒë∆∞·ª£c d√≤ng c√¢u h·ªèi trong block", idx + 1, block);
      return;
    }

    const questionText = qMatch[0].trim();
    const afterQuestion = block.slice(qMatch.index + qMatch[0].length).trim();

    // Gom A./B./C./D. k·ªÉ c·∫£ khi n·∫±m chung 1 d√≤ng
    const choicesObj = { A: "", B: "", C: "", D: "" };
    const choiceRegex = /([ABCD])\.(.*?)(?=(?:[ABCD]\.|$))/gs;
    let m;
    while ((m = choiceRegex.exec(afterQuestion)) !== null) {
      const letter = m[1]; // A/B/C/D
      const text = m[2].replace(/\s+/g, " ").trim();
      choicesObj[letter] = text;
    }

    const choiceArray = ["A", "B", "C", "D"].map(ch => (choicesObj[ch] || "").trim());

    if (!questionText || choiceArray.some(c => c.length === 0)) {
      console.warn("Block", idx + 1, "kh√¥ng h·ª£p l·ªá (thi·∫øu A/B/C/D), s·∫Ω b·ªè qua:", block);
      return;
    }

    parsed.push({
      text: questionText,
      choices: choiceArray
    });
  });

  return parsed;
}

// ==================== T·∫†O ƒê·ªÄ T·ª™ TEXT + ƒê√ÅP √ÅN ====================
function createQuiz() {
  const raw = document.getElementById("rawQuestions").value.trim();
  const keyInput = document.getElementById("answerKey").value
    .trim()
    .toUpperCase()
    .replace(/\s+/g, "");

  if (!raw) {
    alert("B·∫°n ch∆∞a d√°n ƒë·ªÅ.");
    return;
  }
  if (!keyInput) {
    alert("B·∫°n ch∆∞a nh·∫≠p chu·ªói ƒë√°p √°n.");
    return;
  }

  let parsedQuestions = parseQuestions(raw);

  if (parsedQuestions.length === 0) {
    alert("Kh√¥ng parse ƒë∆∞·ª£c c√¢u h·ªèi n√†o. Ki·ªÉm tra l·∫°i format 'C√¢u xx:' v√† A./B./C./D.");
    return;
  }

  if (keyInput.length !== parsedQuestions.length) {
    alert(
      "S·ªë k√Ω t·ª± trong chu·ªói ƒë√°p √°n (" +
        keyInput.length +
        ") kh√¥ng kh·ªõp v·ªõi s·ªë c√¢u h·ªèi parse ƒë∆∞·ª£c (" +
        parsedQuestions.length +
        ")."
    );
    return;
  }

  // H·ªéI NG∆Ø·ªúI D√ôNG C√ì MU·ªêN X√ÅO TR·ªòN KH√îNG
  const userWantsShuffle = confirm(
    "B·∫°n c√≥ mu·ªën x√°o tr·ªôn th·ª© t·ª± c√¢u h·ªèi kh√¥ng?\nOK = C√≥, Cancel = Kh√¥ng."
  );
  shuffleEnabled = userWantsShuffle;

  const letterToIndex = { A: 0, B: 1, C: 2, D: 3 };
  const tempQuestions = [];

  for (let i = 0; i < parsedQuestions.length; i++) {
    const ansLetter = keyInput[i];
    const idx = letterToIndex[ansLetter];
    if (idx === undefined) {
      alert(
        "K√Ω t·ª± ƒë√°p √°n kh√¥ng h·ª£p l·ªá t·∫°i v·ªã tr√≠ " +
          (i + 1) +
          ": " +
          ansLetter +
          " (ch·ªâ ch·∫•p nh·∫≠n A/B/C/D)"
      );
      return;
    }
    tempQuestions.push({
      text: parsedQuestions[i].text,
      choices: parsedQuestions[i].choices,
      correctIndex: idx
    });
  }

  questions = tempQuestions;
  startQuiz();
}

// ==================== B·∫ÆT ƒê·∫¶U L√ÄM B√ÄI ====================
function startQuiz() {
  if (questions.length === 0) {
    alert("Ch∆∞a c√≥ c√¢u h·ªèi.");
    return;
  }
  // T·∫°o list index 0..n-1
  let indices = questions.map((_, i) => i);
  // N·∫øu b·∫≠t shuffle ‚Üí x√°o tr·ªôn
  if (shuffleEnabled) {
    indices = shuffleArray(indices);
  }

  roundList = indices;
  wrongList = [];
  round = 1;
  current = 0;
  finished = false;

  document.getElementById("quiz-box").style.display = "block";
  renderQuestion();
}

// ==================== HI·ªÇN TH·ªä C√ÇU H·ªéI ====================
function renderQuestion() {
  const qIndex = roundList[current];
  const q = questions[qIndex];

  const progressText =
    `L∆∞·ª£t ${round} ‚Äì C√¢u ${current + 1}/${roundList.length} (T·ªïng: ${questions.length} c√¢u)`;
  document.getElementById("progress").innerText = progressText;

  document.getElementById("quiz-title").innerText = q.text;
  document.getElementById("quiz-text").innerText = "";

  document.getElementById("c1").innerText = q.choices[0];
  document.getElementById("c2").innerText = q.choices[1];
  document.getElementById("c3").innerText = q.choices[2];
  document.getElementById("c4").innerText = q.choices[3];

  const statusEl = document.getElementById("status");
  statusEl.innerText = "";
  statusEl.className = "";

  selectedChoice = null;
  updateChoiceSelection();
}

// ==================== CH·ªåN ƒê√ÅP √ÅN (B·∫§M BLOCK) ====================
function updateChoiceSelection() {
  const cards = document.querySelectorAll(".choice-card");
  cards.forEach(card => {
    const idx = Number(card.getAttribute("data-index"));
    if (idx === selectedChoice) {
      card.classList.add("selected");
    } else {
      card.classList.remove("selected");
    }
  });
}

function attachChoiceEvents() {
  const cards = document.querySelectorAll(".choice-card");
  cards.forEach(card => {
    card.addEventListener("click", () => {
      const idx = Number(card.getAttribute("data-index"));
      selectedChoice = idx;
      updateChoiceSelection();
    });
  });
}

// ==================== N·ªòP ƒê√ÅP √ÅN ====================
function submitAnswer() {
  if (finished) return;

  if (selectedChoice === null) {
    alert("H√£y ch·ªçn m·ªôt ƒë√°p √°n (b·∫•m v√†o block ƒë√°p √°n).");
    return;
  }

  const answer = selectedChoice;
  const qIndex = roundList[current];
  const q = questions[qIndex];
  const statusEl = document.getElementById("status");

  if (answer === q.correctIndex) {
    statusEl.innerText = "ƒê√∫ng r·ªìi! ‚úÖ";
    statusEl.className = "ok";
  } else {
    statusEl.innerText = "Sai ‚Äì c√¢u n√†y s·∫Ω ƒë∆∞·ª£c l√†m l·∫°i ·ªü l∆∞·ª£t sau.";
    statusEl.className = "err";
    wrongList.push(qIndex);
  }

  setTimeout(() => nextQuestion(), 700);
}

// ==================== NEXT QUESTION / L∆Ø·ª¢T M·ªöI ====================
function nextQuestion() {
  if (finished) return;

  if (current < roundList.length - 1) {
    current++;
    renderQuestion();
  } else {
    const statusEl = document.getElementById("status");
    if (wrongList.length > 0) {
      round++;

      // V·ªõi l·ª±a ch·ªçn C: x√°o tr·ªôn c·∫£ l∆∞·ª£t sau n·∫øu user ch·ªçn shuffle
      let nextRound = [...wrongList];
      wrongList = [];
      if (shuffleEnabled) {
        nextRound = shuffleArray(nextRound);
      }
      roundList = nextRound;
      current = 0;

      statusEl.innerText =
        `B·∫°n v·∫´n c√≤n c√¢u sai. Chuy·ªÉn sang l∆∞·ª£t ${round} ch·ªâ g·ªìm c√°c c√¢u sai.`;
      statusEl.className = "err";
      setTimeout(() => renderQuestion(), 800);
    } else {
      finished = true;
      statusEl.innerText = "üéâ Ho√†n th√†nh! T·∫•t c·∫£ c√¢u h·ªèi ƒë·ªÅu ƒë√∫ng.";
      statusEl.className = "ok";
    }
  }
}

// ==================== L√ÄM L·∫†I T·ª™ ƒê·∫¶U ====================
function restartQuiz() {
  if (questions.length === 0) return;

  let indices = questions.map((_, i) => i);
  if (shuffleEnabled) {
    indices = shuffleArray(indices);
  }
  roundList = indices;
  wrongList = [];
  round = 1;
  current = 0;
  finished = false;
  renderQuestion();
}

// G·∫Øn s·ª± ki·ªán cho block ƒë√°p √°n
attachChoiceEvents();
</script>

</body>
</html>
